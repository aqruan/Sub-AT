#!/bin/bash
#SBATCH -J test_TinyImagenet
#SBATCH -p dgx2
#SBATCH -o %j.out
#SBATCH -e %j.err
#SBATCH -N 1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=6
#SBATCH --gres=gpu:1
#SBATCH --mail-type=end
#SBATCH --mail-user=li.tao@sjtu.edu.cn

module load miniconda3
source activate mypython3

pip install advertorch

datasets=svhn

#datasets=CIFAR10
#datasets=TinyImagenet
eps=8

#PreActResNet18

for model in PreActResNet18
do
       # TinyImageNet
    #CUDA_VISIBLE_DEVICES=0 python -u train_adv.py --datasets $datasets --lr 0.1 --train_eps $eps --test_eps $eps --wd 0.0005 --arch=$model --epochs=100  --save-dir=save_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps

   CUDA_VISIBLE_DEVICES=0 python -u train_adv.py  --datasets $datasets --lr 0.01 --train_eps $eps --train_gamma 1 --test_gamma 1 --test_eps $eps --wd 0.0005 --arch=$model --epochs=200  --save-dir=save1_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps
   
    #CUDA_VISIBLE_DEVICES=0 python -u train_adv_psgd.py  --datasets $datasets --lr 0.1 --train_eps $eps --test_eps $eps  --params_start 0 --params_end 301  --batch-size 128  --n_components 120 --arch=$model --epochs=20  --save-dir=save_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps\_psgd


    #CUDA_VISIBLE_DEVICES=0 python -u train_adv.py --randomseed 1 --datasets $datasets --lr 0.1 --train_eps $eps --test_eps $eps --wd 0.0005 --arch=$model --epochs=200  --save-dir=save1_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps
   
    #CUDA_VISIBLE_DEVICES=0 python -u train_adv_psgd.py --randomseed 1 --datasets $datasets --lr 1 --train_eps $eps --test_eps $eps  --params_start 0 --params_end 201  --batch-size 128  --n_components 120 --arch=$model --epochs=20  --save-dir=save1_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps\_psgd
   

      #CUDA_VISIBLE_DEVICES=0 python -u train_adv.py --randomseed 2 --datasets $datasets --lr 0.1 --train_eps $eps --test_eps $eps --wd 0.0005 --arch=$model --epochs=200  --save-dir=save2_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps
   
   # CUDA_VISIBLE_DEVICES=0 python -u train_adv_psgd.py --randomseed 2 --datasets $datasets --lr 1 --train_eps $eps --test_eps $eps  --params_start 0 --params_end 201  --batch-size 128  --n_components 120 --arch=$model --epochs=20  --save-dir=save2_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps\_psgd
    

    #CUDA_VISIBLE_DEVICES=0 python -u train_adv_psgd_vgg.py --datasets $datasets --lr 1 --train_eps $eps --test_eps $eps  --params_start 2 --params_end 201  --batch-size 128  --n_components 160 --arch=$model --epochs=40  --save-dir=save_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps\_psgd
      #CUDA_VISIBLE_DEVICES=0 python -u train_adv_psgd.py --datasets $datasets --lr 1 --train_eps $eps --test_eps $eps  --params_start 0 --params_end 201  --batch-size 128  --n_components 180 --arch=$model --epochs=40  --save-dir=save_$model\_$datasets\_eps$eps |& tee -a log_$model\_$datasets\_$eps\_psgd1

    # CIFAR TRADES
    #CUDA_VISIBLE_DEVICES=0 python -u train_adv.py --datasets $datasets --lr 0.1 --tradeloss --train_eps $eps --test_eps $eps --wd 0.0005 --arch=$model --epochs=200  --save-dir=trades_save_$model\_$datasets\_eps$eps |& tee -a trades_log_$model\_$datasets\_$eps
   
    # CUDA_VISIBLE_DEVICES=0 python -u train_adv_psgd.py --datasets $datasets --lr 1 --tradeloss  --train_eps $eps --test_eps $eps  --params_start 0 --params_end 161  --batch-size 128  --n_components 120 --arch=$model --epochs=40  --save-dir=trades_save_$model\_$datasets\_eps$eps |& tee -a trades_log_$model\_$datasets\_$eps\_psgd
    
done    